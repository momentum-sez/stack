{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://schemas.momentum-ez.org/mez/regpack.schema.json",
  "title": "MEZ Regulatory Pack (RegPack)",
  "description": "A RegPack captures dynamic regulatory state that changes faster than lawpacks: sanctions lists, license registries, reporting deadlines, and regulatory guidance.",
  "type": "object",
  "required": [
    "type",
    "stack_spec_version",
    "regpack_id",
    "regpack_version",
    "jurisdiction_id",
    "domain",
    "as_of_date",
    "snapshot_type"
  ],
  "properties": {
    "type": {
      "const": "MEZRegPack"
    },
    "stack_spec_version": {
      "type": "string",
      "minLength": 1
    },
    "regpack_id": {
      "type": "string",
      "pattern": "^regpack:[a-z0-9-]+$",
      "description": "Globally unique regpack identifier."
    },
    "regpack_version": {
      "type": "string",
      "minLength": 1,
      "description": "Semantic version of regpack schema."
    },
    "jurisdiction_id": {
      "type": "string",
      "minLength": 1,
      "description": "Jurisdiction this regpack covers."
    },
    "domain": {
      "type": "string",
      "enum": ["financial", "customs", "sanctions", "tax", "trade", "licensing", "mixed"],
      "description": "Regulatory domain."
    },
    "as_of_date": {
      "type": "string",
      "format": "date",
      "description": "Date this regpack snapshot represents."
    },
    "snapshot_type": {
      "type": "string",
      "enum": ["daily", "weekly", "monthly", "quarterly", "annual", "on_demand"],
      "description": "Refresh frequency for this regpack type."
    },
    "sources": {
      "type": "array",
      "items": {
        "$ref": "#/$defs/regpack_source"
      },
      "description": "Data sources used to compile this regpack."
    },
    "regulators": {
      "type": "array",
      "items": {
        "$ref": "#/$defs/regulator_profile"
      },
      "description": "Regulators covered by this regpack."
    },
    "sanctions_snapshot": {
      "$ref": "#/$defs/sanctions_snapshot",
      "description": "Consolidated sanctions lists snapshot."
    },
    "license_registry": {
      "$ref": "#/$defs/license_registry",
      "description": "License types and requirements."
    },
    "compliance_calendar": {
      "$ref": "#/$defs/compliance_calendar",
      "description": "Reporting deadlines and examination schedules."
    },
    "previous_regpack_digest": {
      "type": "string",
      "pattern": "^[a-f0-9]{64}$",
      "description": "SHA256 digest of previous regpack for delta computation."
    },
    "delta": {
      "$ref": "#/$defs/regpack_delta",
      "description": "Changes from previous regpack."
    },
    "meta": {
      "type": "object",
      "description": "Optional freeform metadata."
    },
    "proof": {
      "description": "Optional DataIntegrityProof."
    }
  },
  "additionalProperties": true,
  "$defs": {
    "regpack_source": {
      "type": "object",
      "required": ["type", "fetched_at"],
      "properties": {
        "type": {
          "type": "string",
          "enum": ["regulator_api", "sanctions_feed", "manual_entry", "government_portal", "third_party"]
        },
        "provider": {
          "type": "string"
        },
        "endpoint": {
          "type": "string",
          "format": "uri"
        },
        "fetched_at": {
          "type": "string",
          "format": "date-time"
        },
        "record_count": {
          "type": "integer",
          "minimum": 0
        },
        "digest_sha256": {
          "type": "string",
          "pattern": "^[a-f0-9]{64}$"
        }
      }
    },
    "regulator_profile": {
      "type": "object",
      "required": ["regulator_id", "name", "jurisdiction_id"],
      "properties": {
        "regulator_id": {
          "type": "string"
        },
        "name": {
          "type": "string"
        },
        "jurisdiction_id": {
          "type": "string"
        },
        "parent_authority": {
          "type": "string"
        },
        "scope": {
          "type": "object",
          "properties": {
            "asset_classes": {
              "type": "array",
              "items": { "type": "string" }
            },
            "activities": {
              "type": "array",
              "items": { "type": "string" }
            },
            "entity_types": {
              "type": "array",
              "items": { "type": "string" }
            }
          }
        },
        "contact": {
          "type": "object",
          "properties": {
            "general_enquiries": { "type": "string" },
            "licensing": { "type": "string" },
            "reporting_portal": { "type": "string", "format": "uri" },
            "api_base_url": { "type": "string", "format": "uri" }
          }
        },
        "api_capabilities": {
          "type": "object",
          "properties": {
            "license_verification": { "type": "boolean" },
            "report_submission": { "type": "boolean" },
            "guidance_query": { "type": "boolean" },
            "sanctions_check": { "type": "boolean" }
          }
        },
        "timezone": {
          "type": "string"
        },
        "business_days": {
          "type": "array",
          "items": {
            "type": "string",
            "enum": ["sunday", "monday", "tuesday", "wednesday", "thursday", "friday", "saturday"]
          }
        }
      }
    },
    "sanctions_snapshot": {
      "type": "object",
      "required": ["snapshot_id", "snapshot_timestamp"],
      "properties": {
        "snapshot_id": {
          "type": "string"
        },
        "snapshot_timestamp": {
          "type": "string",
          "format": "date-time"
        },
        "sources": {
          "type": "object",
          "additionalProperties": {
            "type": "object",
            "properties": {
              "url": { "type": "string", "format": "uri" },
              "fetched_at": { "type": "string", "format": "date-time" },
              "record_count": { "type": "integer" },
              "digest_sha256": { "type": "string" }
            }
          }
        },
        "consolidated": {
          "type": "object",
          "properties": {
            "total_records": { "type": "integer" },
            "individuals": { "type": "integer" },
            "entities": { "type": "integer" },
            "vessels": { "type": "integer" },
            "aircraft": { "type": "integer" }
          }
        },
        "lists_included": {
          "type": "array",
          "items": {
            "type": "string",
            "enum": ["ofac_sdn", "ofac_sectoral", "eu_consolidated", "un_consolidated", "uk_sanctions", "other"]
          }
        }
      }
    },
    "license_registry": {
      "type": "object",
      "properties": {
        "license_types": {
          "type": "array",
          "items": {
            "$ref": "#/$defs/license_type"
          }
        },
        "total_license_types": {
          "type": "integer"
        }
      }
    },
    "license_type": {
      "type": "object",
      "required": ["license_type_id", "name", "regulator_id"],
      "properties": {
        "license_type_id": {
          "type": "string"
        },
        "name": {
          "type": "string"
        },
        "regulator_id": {
          "type": "string"
        },
        "requirements": {
          "type": "object",
          "properties": {
            "minimum_capital": {
              "type": "object",
              "properties": {
                "amount": { "type": "number" },
                "currency": { "type": "string" }
              }
            },
            "key_persons": {
              "type": "object"
            },
            "insurance": {
              "type": "object"
            }
          }
        },
        "application": {
          "type": "object",
          "properties": {
            "fee": {
              "type": "object",
              "properties": {
                "amount": { "type": "number" },
                "currency": { "type": "string" }
              }
            },
            "processing_time_days": { "type": "integer" },
            "documents_required": {
              "type": "array",
              "items": { "type": "string" }
            }
          }
        },
        "validity_period_years": {
          "type": "integer"
        },
        "renewal_lead_time_days": {
          "type": "integer"
        }
      }
    },
    "compliance_calendar": {
      "type": "object",
      "properties": {
        "deadlines": {
          "type": "array",
          "items": {
            "$ref": "#/$defs/reporting_deadline"
          }
        },
        "examinations": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "examination_type": { "type": "string" },
              "window_start": { "type": "string", "format": "date" },
              "window_end": { "type": "string", "format": "date" }
            }
          }
        }
      }
    },
    "reporting_deadline": {
      "type": "object",
      "required": ["report_type_id", "due_date"],
      "properties": {
        "report_type_id": {
          "type": "string"
        },
        "period_end": {
          "type": "string",
          "format": "date"
        },
        "due_date": {
          "type": "string",
          "format": "date"
        },
        "applicable_to": {
          "type": "array",
          "items": { "type": "string" }
        },
        "late_penalty": {
          "type": "object",
          "properties": {
            "grace_period_days": { "type": "integer" },
            "daily_penalty": {
              "type": "object",
              "properties": {
                "amount": { "type": "number" },
                "currency": { "type": "string" },
                "max_days": { "type": "integer" }
              }
            }
          }
        }
      }
    },
    "regpack_delta": {
      "type": "object",
      "properties": {
        "sanctions_additions": { "type": "integer" },
        "sanctions_removals": { "type": "integer" },
        "sanctions_modifications": { "type": "integer" },
        "license_type_changes": { "type": "integer" },
        "guidance_updates": { "type": "integer" },
        "deadline_changes": { "type": "integer" }
      }
    }
  }
}
