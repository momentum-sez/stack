# MEZ Stack v0.4.18 Patchlist â€” Fork Resolution + Transition Envelopes

This patchlist documents the changes introduced in **v0.4.18**.

## Highlights

- **Fork-aware receipt verification**: receipt sets may contain multiple candidates at the same `(sequence, prev_root)`; canonical selection is resolved via **fork-resolution artifacts**.
- **Transition envelopes**: transitions are now expressed as a typed, generic envelope schema that can commit to payload schemas/rulesets/circuits by digest (or typed `ArtifactRef`s).
- **Finality surface area**: added schemas and CLI helpers for anchors and finality status.

## New Schemas

### Core transition packaging
- `schemas/transition-envelope.schema.json`

### Corridor state operations
- `schemas/corridor.receipt-proposal.schema.json`
- `schemas/corridor.fork-resolution.schema.json`
- `schemas/vc.corridor-fork-resolution.schema.json`
- `schemas/corridor.finality-status.schema.json`
- `schemas/corridor.anchor.schema.json`
- `schemas/vc.corridor-anchor.schema.json`

### Corridor governance / ops (scaffolding)
- `schemas/corridor.state-machine.schema.json`
- `schemas/corridor.lifecycle.schema.json`
- `schemas/vc.corridor-lifecycle-transition.schema.json`
- `schemas/corridor.routing.schema.json`

### Watcher bonding + dispute resolution (scaffolding)
- `schemas/vc.watcher-bond.schema.json`
- `schemas/vc.dispute-claim.schema.json`
- `schemas/vc.arbitration-award.schema.json`

## CLI Additions

- `mez corridor state propose`
  - Generates an unsigned **receipt proposal** with a computed `computed_next_root`.
- `mez corridor state fork-resolve`
  - Generates an unsigned **fork-resolution VC** selecting the canonical `next_root` for a fork point.
- `mez corridor state anchor`
  - Generates an unsigned **corridor-anchor VC** referencing a head commitment digest and chain anchor info.
- `mez corridor state finality-status`
  - Computes a `MEZCorridorFinalityStatus` using receipts (and optionally a checkpoint + watcher quorum + anchors).

## Notable Changes

- `schemas/corridor.receipt.schema.json`
  - `transition` is now a `$ref` to `transition-envelope.schema.json`.
- `tools/mez.py`
  - Corridor receipt verification is now fork-aware and supports canonical chain selection via `--fork-resolutions`.
  - Receipt-chain operations (`checkpoint`, `proof`) accept `--fork-resolutions` as well.

## Compatibility Notes

- Legacy transition attachments without `artifact_type` remain valid.
- If a fork exists and no fork-resolution artifact is supplied, verification fails with a clear error.
