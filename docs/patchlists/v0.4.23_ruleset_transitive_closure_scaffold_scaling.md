# v0.4.23 patchlist

This patch is a focused hardening step on top of v0.4.22.

## Goals

1. **Deepen transitive artifact completeness** so `--transitive-require-artifacts` covers not just the `transition-types.lock` snapshot dependencies, but also **nested typed commitments embedded inside referenced ruleset artifacts**.
2. **Scale scenario test libraries by 10x+** without slowing default CI runs (module-level gating), while keeping scaffolds deterministic and mechanically enumerable.

## Core changes

### 1) Transition registry → ruleset → nested ArtifactRef closure

**Behavior:** When a receipt commits to `transition_type_registry_digest_sha256` and verification is run with:

- `--require-artifacts` → require the committed lock itself and direct digest commitments resolve via CAS
- `--transitive-require-artifacts` → additionally require that **all schema/ruleset/circuit digests referenced by the lock resolve via CAS**, *and* that any **embedded `ArtifactRef` objects inside referenced ruleset artifacts** also resolve.

This makes it practical to introduce proof-carrying transitions where a ruleset commits to `proof-key` and/or `circuit` artifacts via typed `ArtifactRef` fields.

**Files:**
- `tools/msez.py`
  - Added `_iter_embedded_artifactrefs(...)`
  - Extended `_require_transition_types_lock_transitive(...)` to scan referenced ruleset artifacts for embedded `ArtifactRef`s
  - Updated CLI help text for `--transitive-require-artifacts`

### 2) Scenario scaffolds are now module-gated

Default `pytest -q` runs should stay fast and low-noise.

**Behavior:** Scenario suites in `tests/scenarios/*` now skip at the module level unless:

- `MSEZ_RUN_SCAFFOLD=1`

When enabled, the scaffold suites expand into a very large matrix intended for systematic roadmap closure.

**Files:**
- `tests/scenarios/test_comprehensive_library_scaffold.py`
- `tests/scenarios/test_deep_edge_cases_scaffold.py`
- `tests/scenarios/test_smart_asset_integration_scaffold.py`

### 3) Repo hygiene

Removed accidental `__pycache__` / `*.pyc` artifacts from the tree.

## Tests

- `tests/test_transitive_require_artifacts.py`
  - Added `test_transitive_require_artifacts_expands_ruleset_nested_artifactrefs(...)`

## Version bump

- Stack spec version bumped from `0.4.22` → `0.4.23`.
- Updated:
  - `tools/msez.py`
  - `README.md`
  - `apis/*.openapi.yaml`
  - `profiles/*/profile.yaml`
  - `jurisdictions/_starter/stack.lock`
  - `governance/CHANGELOG.md`

