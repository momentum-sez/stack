{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://schemas.momentum-ez.org/mez/trade.invoice.v1.schema.json",
  "title": "Trade Invoice (v1)",
  "description": "A minimal, deterministic trade invoice schema suitable for open-account and trade-finance workflows. This is an interoperability boundary; deployments may extend via meta and attachment artifacts.",
  "type": "object",
  "required": ["invoice_id", "issue_date", "seller", "buyer", "total"],
  "properties": {
    "invoice_id": {
      "type": "string",
      "minLength": 1,
      "description": "Stable invoice identifier (internal or globally unique)."
    },
    "invoice_number": {
      "type": "string",
      "description": "Human-facing invoice number (may be non-unique across systems)."
    },
    "issue_date": {
      "type": "string",
      "format": "date",
      "description": "Invoice issue date (YYYY-MM-DD)."
    },
    "due_date": {
      "type": "string",
      "format": "date",
      "description": "Payment due date (YYYY-MM-DD)."
    },
    "seller": {
      "$ref": "https://schemas.momentum-ez.org/mez/trade.party.v1.schema.json"
    },
    "buyer": {
      "$ref": "https://schemas.momentum-ez.org/mez/trade.party.v1.schema.json"
    },
    "total": {
      "$ref": "https://schemas.momentum-ez.org/mez/trade.amount.v1.schema.json"
    },
    "tax": {
      "$ref": "https://schemas.momentum-ez.org/mez/trade.amount.v1.schema.json"
    },
    "line_items": {
      "type": "array",
      "items": {
        "type": "object",
        "required": ["description", "quantity", "unit_price", "amount"],
        "properties": {
          "description": {"type": "string", "minLength": 1},
          "sku": {"type": "string"},
          "hs_code": {"type": "string"},
          "quantity": {"type": "string", "pattern": "^[0-9]+(\\.[0-9]{1,12})?$"},
          "unit_of_measure": {"type": "string"},
          "unit_price": {"$ref": "https://schemas.momentum-ez.org/mez/trade.amount.v1.schema.json"},
          "amount": {"$ref": "https://schemas.momentum-ez.org/mez/trade.amount.v1.schema.json"},
          "meta": {"type": "object", "additionalProperties": true}
        },
        "additionalProperties": false
      }
    },
    "purchase_order_ref": {
      "type": "string",
      "description": "Optional purchase order reference."
    },
    "contract_ref": {
      "type": "string",
      "description": "Optional contract reference (e.g., master sales agreement)."
    },
    "incoterms": {
      "type": "string",
      "description": "Optional Incoterms code (e.g., FOB, CIF) and place."
    },
    "shipment_ref": {
      "type": "string",
      "description": "Optional shipment reference (links to BOL or logistics system)."
    },
    "governing_law": {
      "type": "string",
      "description": "Optional governing law / lawpack identifier (deployment-specific)."
    },
    "jurisdiction_tags": {
      "type": "array",
      "items": {"type": "string"},
      "description": "Optional tags used for routing/compliance policy (e.g., zone ids, customs regimes)."
    },
    "attachment_refs": {
      "type": "array",
      "items": {"$ref": "https://schemas.momentum-ez.org/mez/artifact-ref.schema.json"},
      "description": "Optional attachment artifact references (PDF invoice, signed copies, packing list, etc.)."
    },
    "meta": {
      "type": "object",
      "description": "Non-normative extension metadata.",
      "additionalProperties": true
    }
  },
  "additionalProperties": false
}
