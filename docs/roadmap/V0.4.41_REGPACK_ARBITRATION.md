# v0.4.41: RegPack + Arbitration System — The Hardcore Release

## Overview

v0.4.41 implements the two major missing production pieces:

1. **RegPack System** — Dynamic regulatory state that Lawpacks cannot capture
2. **Arbitration System** — Programmatic dispute resolution with automatic enforcement

This is the "radical yahoo" release that transforms the EZ Stack from a compliance framework into a complete trade automation platform.

---

## Why This Matters

**Lawpacks** capture static law (statutes, regulations) — changes slowly (months/years).

**RegPacks** capture dynamic regulatory state:
- Regulatory guidance (changes: weeks/months)
- Enforcement priorities (changes: days/weeks)
- Sanctions lists (changes: **daily**)
- License requirements (changes: months)
- Reporting deadlines (changes: quarterly)
- Examination schedules (changes: annually)

**Arbitration** enables programmatic dispute resolution:
- Machine-readable rulings
- Automatic enforcement via smart asset state transitions
- Evidence bundles from CAS with full audit trail

---

## PART I: REGPACK SYSTEM

### 1.1 RegPack Structure

```
regpacks/<jurisdiction_id>/<domain>/<snapshot_id>/
├── regpack.yaml                    # Metadata
├── digest.sha256                   # Canonical digest
├── regulators/
│   ├── index.json                  # Regulator registry
│   └── <regulator_id>/
│       ├── profile.json            # Identity, contact, scope
│       ├── licenses/
│       │   ├── index.json          # License types
│       │   └── <license_type>.json # Requirements, fees, validity
│       ├── reporting/
│       │   ├── index.json          # Report types
│       │   └── <report_type>.json  # Schema, deadlines, submission API
│       ├── guidance/
│       │   └── <guidance_id>.json  # Guidance with ArtifactRef
│       └── enforcement/
│           └── <action_id>.json    # Enforcement actions
├── sanctions/
│   ├── snapshot_metadata.json      # Snapshot timestamp, sources
│   ├── consolidated.json           # Merged sanctions list
│   ├── ofac/sdn.json
│   ├── eu/consolidated.json
│   └── un/consolidated.json
├── compliance_calendar/
│   ├── deadlines.json              # Upcoming deadlines
│   └── examinations.json           # Examination windows
└── api_endpoints/
    └── <regulator_id>.json         # OpenAPI specs
```

### 1.2 Key Schemas

- `schemas/regpack.metadata.schema.json`
- `schemas/regpack.regulator-profile.schema.json`
- `schemas/regpack.license-type.schema.json`
- `schemas/regpack.reporting-requirement.schema.json`
- `schemas/regpack.sanctions-snapshot.schema.json`
- `schemas/regpack.compliance-deadline.schema.json`
- `schemas/vc.regpack-attestation.schema.json`

### 1.3 CLI Commands

```bash
# Ingestion
mez regpack ingest <jurisdiction> --domain <domain> --as-of-date 2026-01-15
mez regpack fetch-sanctions --sources ofac,eu,un --out sanctions.json

# Verification
mez regpack verify <regpack_path> --strict
mez regpack sanctions-check --regpack <digest> --entity <name_or_id>

# Attestation
mez regpack attest --regpack <digest> --issuer <did> --sign --key <jwk>

# Corridor binding
mez corridor regpack-bind <corridor> --zone <zone> --regpack <digest>

# Freshness check
mez regpack freshness-check --corridor <corridor> --max-age 7d
```

### 1.4 RegPack Digest Computation

```
regpack_digest = SHA256(
  "mez-regpack-v1\0" ||
  JCS(regpack.yaml) ||
  JCS(regulators/index.json) ||
  JCS(sanctions/snapshot_metadata.json) ||
  JCS(compliance_calendar/deadlines.json) ||
  ... (all JSON files, sorted by path)
)
```

---

## PART II: ARBITRATION SYSTEM

### 2.1 Institution Registry

```yaml
# registries/arbitration-institutions.yaml
institutions:
  difc-lcia:
    name: "DIFC-LCIA Arbitration Centre"
    jurisdiction_id: "uae-difc"
    rules_url: "https://www.difc-lcia.org/rules"
    api_base_url: "https://api.difc-lcia.org/v1"
    supported_dispute_types:
      - breach_of_contract
      - non_conforming_goods
      - payment_default
      - delivery_failure
    emergency_arbitrator: true
    expedited_procedure: true
    fee_schedule:
      filing_fee_usd: 3000
      hourly_rate_range: [350, 750]

  siac:
    name: "Singapore International Arbitration Centre"
    jurisdiction_id: "sg"
    # ...

  icc:
    name: "International Chamber of Commerce Court of Arbitration"
    jurisdiction_id: "fr-paris"
    # ...
```

### 2.2 Dispute Filing Protocol

```
PROTOCOL: DisputeFiling

INPUTS:
  - corridor_id: string
  - claimant: DID
  - respondent: DID
  - claims: DisputeClaim[]
  - evidence_bundle: WitnessBundle
  - escrow_amount: Money

PROCESS:
  1. VALIDATE claimant/respondent are corridor parties
  2. VALIDATE claims reference corridor receipts
  3. COMPUTE evidence_bundle_digest
  4. CREATE dispute_request_artifact
  5. SUBMIT to arbitration corridor
  6. LOCK escrow (filing fee + potential award)
  7. EMIT DisputeFiledReceipt

OUTPUT:
  - dispute_id: string
  - receipt: CorridorReceipt
```

### 2.3 Key Schemas

- `schemas/arbitration.institution.schema.json`
- `schemas/arbitration.dispute-request.schema.json`
- `schemas/arbitration.evidence-package.schema.json`
- `schemas/arbitration.ruling.schema.json`
- `schemas/vc.arbitration-ruling.schema.json`
- `schemas/arbitration.enforcement-receipt.schema.json`

### 2.4 Smart Asset Arbitration Transitions

New transition kinds:
- `arbitration.dispute.file`
- `arbitration.dispute.respond`
- `arbitration.evidence.submit`
- `arbitration.ruling.receive`
- `arbitration.ruling.enforce`
- `arbitration.appeal.file`
- `arbitration.settlement.agree`

### 2.5 CLI Commands

```bash
# Dispute filing
mez arbitration dispute-file \
  --corridor <corridor> \
  --claimant <did> \
  --respondent <did> \
  --claims <claims.json> \
  --evidence-bundle <bundle.zip> \
  --sign --key <jwk>

# Evidence submission
mez arbitration evidence-submit \
  --dispute <dispute_id> \
  --evidence <evidence.json> \
  --witness-bundle <bundle.zip>

# Ruling processing
mez arbitration ruling-verify <ruling.vc.json>
mez arbitration ruling-enforce \
  --ruling <ruling.vc.json> \
  --asset <asset_id> \
  --corridor <corridor>

# Status
mez arbitration status --dispute <dispute_id>
```

### 2.6 Automatic Enforcement Protocol

```
PROTOCOL: ArbitrationEnforcement

INPUTS:
  - ruling_vc: MEZArbitrationRulingCredential
  - smart_asset: SmartAsset (bound to corridor)
  - escrow_state: EscrowState

PROCESS:
  1. VERIFY ruling_vc signature against institution DID
  2. VERIFY ruling_vc.dispute_id matches smart_asset dispute records
  3. VERIFY appeal_deadline has passed OR appeal_waiver received
  4. FOR EACH order IN ruling_vc.orders:
       IF order.enforcement_method == "smart_asset_state_transition":
         a. CONSTRUCT enforcement_transition_envelope
         b. ATTACH ruling_vc as evidence
         c. SUBMIT to corridor state channel
         d. UPDATE smart_asset.state per order
  5. IF escrow exists:
       RELEASE escrow per escrow_release_conditions
  6. EMIT EnforcementReceipt to corridor

OUTPUT:
  - enforcement_receipt: CorridorReceipt
  - updated_asset_state: SmartAssetState
```

---

## PART III: CORRIDOR INTEGRATION

### 3.1 Arbitration Corridor Specialization

```yaml
# modules/corridors/arbitration-difc/corridor.yaml
corridor_id: org.momentum.mez.corridor.arbitration.difc-lcia
corridor_type: arbitration
arbitration_config:
  institution_id: difc-lcia
  supported_dispute_types:
    - breach_of_contract
    - non_conforming_goods
    - payment_default
    - delivery_failure
  linked_corridors:
    - corridor_id: "corridor:uae-kaz-trade-01"
      role: primary
    - corridor_id: "corridor:uae-kaz-settlement-01"
      role: enforcement
  escrow_requirements:
    filing_fee_escrow: true
    award_escrow: true
  automation_level:
    evidence_extraction: automatic
    ruling_enforcement: automatic_with_appeal_wait
    cost_allocation: automatic
```

### 3.2 RegPack Binding

```yaml
# In corridor agreement
regpack_requirements:
  - zone_id: ae-dubai-difc
    regpack_ref:
      artifact_type: regpack
      digest_sha256: "..."
    max_age_days: 7
    required_components:
      - sanctions
      - licenses
  - zone_id: kaz-aifc
    regpack_ref:
      artifact_type: regpack
      digest_sha256: "..."
    max_age_days: 30
```

---

## PART IV: TEST COVERAGE REQUIREMENTS

### 4.1 RegPack Tests (minimum 15)

- [ ] `test_regpack_metadata_schema_validates`
- [ ] `test_regpack_digest_computation_deterministic`
- [ ] `test_regpack_sanctions_snapshot_parsing`
- [ ] `test_regpack_ofac_sdn_ingestion`
- [ ] `test_regpack_eu_sanctions_ingestion`
- [ ] `test_regpack_un_sanctions_ingestion`
- [ ] `test_regpack_sanctions_consolidation`
- [ ] `test_regpack_sanctions_delta_computation`
- [ ] `test_regpack_license_type_validation`
- [ ] `test_regpack_reporting_deadline_computation`
- [ ] `test_regpack_attestation_vc_generation`
- [ ] `test_regpack_attestation_vc_verification`
- [ ] `test_regpack_corridor_binding`
- [ ] `test_regpack_freshness_check`
- [ ] `test_regpack_sanctions_check_entity_match`

### 4.2 Arbitration Tests (minimum 15)

- [ ] `test_arbitration_institution_registry_loads`
- [ ] `test_arbitration_dispute_request_schema`
- [ ] `test_arbitration_evidence_package_schema`
- [ ] `test_arbitration_ruling_vc_schema`
- [ ] `test_arbitration_dispute_file_creates_receipt`
- [ ] `test_arbitration_evidence_submit_updates_chain`
- [ ] `test_arbitration_ruling_verify_signature`
- [ ] `test_arbitration_ruling_enforce_transitions_asset`
- [ ] `test_arbitration_appeal_deadline_enforcement`
- [ ] `test_arbitration_escrow_lock_on_file`
- [ ] `test_arbitration_escrow_release_on_award`
- [ ] `test_arbitration_cost_allocation`
- [ ] `test_arbitration_corridor_specialization`
- [ ] `test_arbitration_linked_corridor_anchoring`
- [ ] `test_arbitration_settlement_agreement`

### 4.3 Integration Tests (minimum 10)

- [ ] `test_trade_corridor_with_regpack_binding`
- [ ] `test_trade_corridor_dispute_to_arbitration`
- [ ] `test_arbitration_ruling_enforces_settlement`
- [ ] `test_multi_jurisdiction_regpack_freshness`
- [ ] `test_sanctions_block_counterparty_transit`
- [ ] `test_license_expiry_blocks_transition`
- [ ] `test_full_trade_to_dispute_to_award_flow`
- [ ] `test_emergency_arbitrator_fast_path`
- [ ] `test_regpack_delta_triggers_corridor_alert`
- [ ] `test_witness_bundle_includes_regpack_evidence`

---

## PART V: IMPLEMENTATION CHECKLIST

### 5.1 Schemas (18 new)

- [ ] `schemas/regpack.metadata.schema.json`
- [ ] `schemas/regpack.regulator-profile.schema.json`
- [ ] `schemas/regpack.license-type.schema.json`
- [ ] `schemas/regpack.reporting-requirement.schema.json`
- [ ] `schemas/regpack.sanctions-snapshot.schema.json`
- [ ] `schemas/regpack.sanctions-entry.schema.json`
- [ ] `schemas/regpack.compliance-deadline.schema.json`
- [ ] `schemas/vc.regpack-attestation.schema.json`
- [ ] `schemas/arbitration.institution.schema.json`
- [ ] `schemas/arbitration.dispute-request.schema.json`
- [ ] `schemas/arbitration.claim.schema.json`
- [ ] `schemas/arbitration.evidence-package.schema.json`
- [ ] `schemas/arbitration.ruling.schema.json`
- [ ] `schemas/arbitration.order.schema.json`
- [ ] `schemas/vc.arbitration-ruling.schema.json`
- [ ] `schemas/arbitration.enforcement-receipt.schema.json`
- [ ] `schemas/arbitration.settlement-agreement.schema.json`
- [ ] `schemas/arbitration.corridor-config.schema.json`

### 5.2 CLI Commands (12 new)

- [ ] `mez regpack ingest`
- [ ] `mez regpack fetch-sanctions`
- [ ] `mez regpack verify`
- [ ] `mez regpack sanctions-check`
- [ ] `mez regpack attest`
- [ ] `mez corridor regpack-bind`
- [ ] `mez regpack freshness-check`
- [ ] `mez arbitration dispute-file`
- [ ] `mez arbitration evidence-submit`
- [ ] `mez arbitration ruling-verify`
- [ ] `mez arbitration ruling-enforce`
- [ ] `mez arbitration status`

### 5.3 Transition Types (7 new)

- [ ] `arbitration.dispute.file.v1`
- [ ] `arbitration.dispute.respond.v1`
- [ ] `arbitration.evidence.submit.v1`
- [ ] `arbitration.ruling.receive.v1`
- [ ] `arbitration.ruling.enforce.v1`
- [ ] `arbitration.appeal.file.v1`
- [ ] `arbitration.settlement.agree.v1`

### 5.4 Module Templates (3 new)

- [ ] `modules/corridors/arbitration-difc/_template/`
- [ ] `modules/regpacks/_template/`
- [ ] `profiles/arbitration-enabled-trade/`

### 5.5 Documentation (5 new)

- [ ] `docs/architecture/REGPACK-SYSTEM.md`
- [ ] `docs/architecture/ARBITRATION-SYSTEM.md`
- [ ] `docs/operators/regpack-management.md`
- [ ] `docs/operators/arbitration-workflows.md`
- [ ] `docs/examples/trade-with-arbitration/README.md`

---

## SHIP DECISION

v0.4.41 is authorized when:

1. All 18 schemas pass validation
2. All 12 CLI commands work with --help and basic usage
3. All 40+ tests pass
4. RegPack sanctions check works for OFAC/EU/UN
5. Arbitration dispute→ruling→enforce flow completes
6. Trade playbook extended with arbitration example
7. CI enforces all new invariants
