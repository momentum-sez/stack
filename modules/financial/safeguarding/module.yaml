module_id: financial.safeguarding
version: 0.4.44
kind: financial-infrastructure
name: Client Fund Safeguarding
description: |
  Client fund safeguarding infrastructure for Special Economic Zones.
  Ensures proper segregation, protection, and reconciliation of
  client funds as required by EMI and payment institution regulations.

  Regulatory Compliance:
  - EMD2 Safeguarding Requirements
  - PSD2 Fund Protection
  - Client Money Rules
  - Trust Account Requirements

  Capabilities:
  - Fund Segregation
  - Daily Reconciliation
  - Shortfall Detection
  - Insurance/Guarantee Management
  - Regulatory Reporting

license: Apache-2.0

interfaces:
  - interface_id: financial.safeguarding.segregation
    name: Fund Segregation Interface
    operations:
      - op_id: create_safeguarding_account
        name: Create Safeguarding Account
        inputs:
          - name: institution_id
            type: string
          - name: currency
            type: string
          - name: banking_partner
            type: string
          - name: account_type
            type: string
            enum: [segregated, trust, escrow]
        outputs:
          - name: account
            type: SafeguardingAccount

      - op_id: deposit_client_funds
        name: Deposit Client Funds
        inputs:
          - name: safeguarding_account_id
            type: string
          - name: client_id
            type: string
          - name: amount
            type: number
          - name: source_reference
            type: string
        outputs:
          - name: deposit
            type: SafeguardingDeposit

      - op_id: withdraw_client_funds
        name: Withdraw Client Funds
        inputs:
          - name: safeguarding_account_id
            type: string
          - name: client_id
            type: string
          - name: amount
            type: number
          - name: destination
            type: string
        outputs:
          - name: withdrawal
            type: SafeguardingWithdrawal

  - interface_id: financial.safeguarding.reconciliation
    name: Reconciliation Interface
    operations:
      - op_id: perform_daily_reconciliation
        name: Perform Daily Reconciliation
        inputs:
          - name: institution_id
            type: string
          - name: reconciliation_date
            type: string
            format: date
        outputs:
          - name: reconciliation
            type: ReconciliationReport

      - op_id: detect_shortfall
        name: Detect Shortfall
        inputs:
          - name: institution_id
            type: string
        outputs:
          - name: shortfall_report
            type: ShortfallReport

      - op_id: report_to_regulator
        name: Report to Regulator
        inputs:
          - name: institution_id
            type: string
          - name: report_type
            type: string
            enum: [daily, weekly, monthly, incident]
          - name: period_end
            type: string
            format: date
        outputs:
          - name: regulatory_report
            type: RegulatoryReport

  - interface_id: financial.safeguarding.protection
    name: Fund Protection Interface
    operations:
      - op_id: setup_insurance
        name: Setup Safeguarding Insurance
        inputs:
          - name: institution_id
            type: string
          - name: coverage_amount
            type: number
          - name: insurer
            type: string
        outputs:
          - name: insurance
            type: SafeguardingInsurance

      - op_id: setup_guarantee
        name: Setup Bank Guarantee
        inputs:
          - name: institution_id
            type: string
          - name: guarantee_amount
            type: number
          - name: guarantor_bank
            type: string
        outputs:
          - name: guarantee
            type: BankGuarantee

schemas:
  - schema_id: SafeguardingAccount
    properties:
      account_id:
        type: string
      institution_id:
        type: string
      currency:
        type: string
      account_type:
        type: string
      banking_partner:
        type: string
      balance:
        type: number
      status:
        type: string
        enum: [active, suspended, closed]

  - schema_id: ReconciliationReport
    properties:
      report_id:
        type: string
      reconciliation_date:
        type: string
        format: date
      client_liability:
        type: number
      safeguarded_funds:
        type: number
      variance:
        type: number
      status:
        type: string
        enum: [matched, shortfall, excess]
      discrepancies:
        type: array

  - schema_id: ShortfallReport
    properties:
      report_id:
        type: string
      detection_time:
        type: string
        format: date-time
      shortfall_amount:
        type: number
      affected_clients:
        type: integer
      remediation_deadline:
        type: string
        format: date-time
      status:
        type: string
        enum: [detected, reported, remediated]

dependencies:
  - module_id: financial.banking-adapter
    version: ">=0.1.0"
  - module_id: operational.audit-logging
    version: ">=0.1.0"

variants:
  - variant_id: full
    name: Full Safeguarding
    features: [segregation, reconciliation, protection, reporting]
  - variant_id: basic
    name: Basic Safeguarding
    features: [segregation, reconciliation]

tags: [safeguarding, client-money, segregation, reconciliation, compliance]
