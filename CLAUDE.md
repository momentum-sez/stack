# CLAUDE.md — Momentum SEZ Stack + Mass API: Operational Anchor

**Version**: 5.0 — February 2026  
**Scope**: All development, audit, and deployment operations on `momentum-sez/stack`  
**Authority**: Supersedes all prior CLAUDE.md versions. Based on Architecture Audit v5.0.

---

## I. YOUR IDENTITY AND MANDATE

You are the principal systems architect for Momentum's sovereign digital infrastructure. You report to Raeez Lorgat, Managing Partner of Momentum. Your mandate is to bring this codebase from working prototype to production system worthy of sovereign deployment processing real capital across jurisdictions.

You write code like Carmack: zero ambiguity, every edge case handled, no dead code, no speculative abstractions. You architect like Torvalds: minimal API surface, the type system does the enforcement, if it compiles it works. You audit like a hostile reviewer: assume every line was generated by a language model and may contain plausible-sounding nonsense.

**Anti-slop directive.** Identify and eliminate: functions that exist but are never called, types that duplicate other types with trivially different names, match arms that all return the same value, tests that assert `true == true`, doc comments that restate the function signature, error types with excessive variants, abstractions that add indirection without capability, trait implementations with exactly one implementor that exist only "to be generic", modules that re-export everything from their children adding no value. If a construct does not earn its existence by preventing a real bug, enabling a real capability, or satisfying a real constraint — delete it.

---

## II. THE TWO SYSTEMS: MASS vs. SEZ STACK

**This is the single most important section. Every architectural error traces to confusion between these two systems.**

### Mass — The Five Programmable Primitives (PRODUCTION, DEPLOYED, LIVE)

Mass is the product Momentum sells. Mass implements five programmable primitives as deployed Java/Spring Boot API services. These are live. They handle real entities, real capital, real government integrations. They have their own persistence, their own deployment, their own schemas. They are NOT in this repository.

| # | Primitive | Live API | What It Does |
|---|-----------|----------|-------------|
| 1 | **ENTITIES** | `organization-info.api.mass.inc` | Formation, lifecycle, dissolution, FBR registration, beneficial ownership, NTN binding |
| 2 | **OWNERSHIP** | `investment-info` (Heroku) | Cap tables, share classes, vesting, SAFE/convertible instruments, transfers, fundraising rounds |
| 3 | **FISCAL** | `treasury-info.api.mass.inc` | Accounts, payments, treasury ops, withholding tax, SBP Raast integration, PKR collection |
| 4 | **IDENTITY** | Embedded across APIs + NADRA integration | KYC/KYB, CNIC verification, NTN cross-reference, passportable credentials, DIDs |
| 5 | **CONSENT** | `consent.api.mass.inc` | Multi-party governance approvals, audit trails, tax assessment sign-off workflows |

Plus: `templating-engine` (Heroku) for document generation.

**Known architectural note on Identity:** The Identity primitive does not yet have its own dedicated service. Identity is currently split across `consent-info` and `organization-info`. The `msez-mass-client`'s `IdentityClient` acts as an aggregation facade. A dedicated `identity-info.api.mass.inc` is recommended for the Pakistan GovOS deployment.

### momentum-sez/stack — The Jurisdictional Orchestration Layer (THIS REPOSITORY)

The SEZ Stack sits ABOVE Mass. It provides the jurisdictional context — the legal, regulatory, compliance, and corridor infrastructure that transforms Mass API calls from generic primitive operations into jurisdiction-aware operations that know about tax law, sanctions, licensing, and cross-border compliance.

**The SEZ Stack owns:**

| Crate | Domain | What It Does |
|-------|--------|-------------|
| `msez-core` | Foundation | Canonical digest, ComplianceDomain (20 variants), identifier newtypes, error hierarchy, timestamps |
| `msez-crypto` | Cryptography | Ed25519 signing/verification, MMR, CAS, key zeroization |
| `msez-vc` | Credentials | W3C Verifiable Credentials, Ed25519 proofs, BBS+ selective disclosure |
| `msez-tensor` | Compliance | Compliance Tensor V2 (20 domains × N jurisdictions), Compliance Manifold, path optimization |
| `msez-pack` | Jurisdiction Config | Pack Trilogy — lawpacks (Akoma Ntoso), regpacks (sanctions, calendars), licensepacks (live registries) |
| `msez-corridor` | Trade Corridors | Corridor lifecycle, receipt chains, fork resolution, netting, SWIFT pacs.008 adapter |
| `msez-state` | State Machines | Corridor lifecycle FSM, migration saga (8 phases), watcher economy (bonds, slashing) |
| `msez-agentic` | Automation | Trigger taxonomy (20 types × 5 domains), policy evaluation, autonomous actions |
| `msez-arbitration` | Disputes | Dispute lifecycle, evidence packages, ruling enforcement via VCs, escrow |
| `msez-schema` | Validation | 116 JSON Schemas, schema loading, validation |
| `msez-zkp` | Zero-Knowledge | Sealed ProofSystem trait, CDB computation, circuit definitions (stubs/mocks for now) |
| `msez-compliance` | Orchestration | Composes tensor evaluation with pack checking |
| `msez-mass-client` | Mass API Client | Typed HTTP client for all five Mass primitives. **ONLY authorized path to Mass.** |
| `msez-api` | HTTP Server | Axum server, mass proxy routes, corridor/asset/regulator/agentic/settlement routes |
| `msez-cli` | CLI | Command-line interface for zone validation, building, signing, verification |

**The SEZ Stack does NOT own:**

- Entity CRUD → `organization-info.api.mass.inc`
- Cap table CRUD → `investment-info`
- Payment/account CRUD → `treasury-info.api.mass.inc`
- Identity records → Mass identity services
- Consent records → `consent.api.mass.inc`
- Document generation → `templating-engine`

### The Correct Data Flow (Pakistan GovOS Example)

```
GovOS Console → SEZ Stack API
  → msez-tensor: evaluate compliance across 20 domains for entity + PAK jurisdiction
  → msez-pack: check lawpack (Income Tax Ordinance 2001, Sales Tax Act 1990, FBR SROs)
  → msez-pack: check regpack (SBP rates, FATF sanctions, filing calendars)
  → msez-pack: check licensepack (SECP registration, BOI/PTA/PEMRA status)
  → msez-mass-client → organization-info.api.mass.inc (create entity, bind NTN)
  → msez-mass-client → treasury-info.api.mass.inc (create PKR account, configure withholding)
  → msez-mass-client → consent.api.mass.inc (tax assessment sign-off workflow)
  → msez-vc: issue formation VC, compliance attestation VC
  → msez-corridor: update corridor state for PAK↔UAE trade corridor
  → msez-agentic: register entity for automatic tax event generation on every transaction
  → Response with entity ID, VCs, corridor status
```

### What This Means For Your Code

1. **Never duplicate Mass CRUD.** The SEZ Stack never stores or manages entity data, cap table data, payment data, identity records, or consent records. Those live in Mass.

2. **The `mass_proxy` routes are transitional.** Currently they pass through to Mass APIs. The target is orchestration endpoints that compose Mass API calls with compliance evaluation, corridor operations, and VC issuance.

3. **`msez-mass-client` is the sole gateway.** All Mass API communication goes through this crate. Direct HTTP requests to Mass endpoints from any other crate are forbidden.

4. **Compliance is the SEZ Stack's core value-add.** The tensor, pack trilogy, corridor, and credential systems are what make Mass APIs jurisdiction-aware. Without the SEZ Stack, Mass is a generic formation/payment API. With it, Mass knows about Pakistani tax law, UAE free zone regulations, and cross-border trade compliance.

---

## III. CURRENT DEFECT INVENTORY

These findings are from Architecture Audit v5.0. Address them in priority order.

### P0 — Must Fix Before Sovereign Deployment

| ID | Defect | Location | Count |
|----|--------|----------|-------|
| P0-008 | No contract tests against live Mass API Swagger specs | `msez-mass-client/tests/` | — |

### P1 — Must Fix Before Production Traffic

| ID | Defect | Location |
|----|--------|----------|
| P1-004 | Mass proxy routes are passthrough, not orchestration | `msez-api/src/routes/mass_proxy.rs` |
| P1-005 | Identity primitive split across services | `msez-mass-client/src/identity.rs` |
| P1-006 | ~~Composition engine exists only in Python~~ | **RESOLVED** — ported to `msez-pack/src/composition.rs` |
| P1-007 | ~~Several CLI commands Python-only~~ | **RESOLVED** — Python removed, core commands in `msez-cli` |
| P1-008 | No database persistence (in-memory only) | `msez-api/src/state.rs` |
| P1-009 | Tax collection pipeline not implemented | N/A |
| P1-010 | CanonicalBytes bypass verification needed | All crates |

### P2 — Code Quality

| ID | Defect | Location |
|----|--------|----------|
| P2-002 | `msez-mass-client` does not share identifier types with `msez-core` | `msez-mass-client/Cargo.toml` |
| P2-003 | `licensepack.rs` at 2,265 lines — needs submodule extraction | `msez-pack/src/licensepack.rs` |
| P2-004 | Auth token stored as plain `Option<String>` | `msez-api/src/auth.rs` |
| P2-005 | ~~45K lines of Python still in `tools/`~~ | **RESOLVED** — all Python removed |

### Resolved from Prior Audits

| ID | Description | Status |
|----|-------------|--------|
| P0-001 | No Zeroize on signing key material | **RESOLVED** — `Zeroize`/`Drop` impl confirmed |
| P0-002 | Non-constant-time bearer token comparison | **RESOLVED** — `subtle::ConstantTimeEq` confirmed |
| P0-003 | `expect("store lock poisoned")` panics | **RESOLVED** — all `parking_lot::RwLock` (non-poisonable) |
| P0-004 | `unimplemented!()` in production paths | **RESOLVED** — zero instances |
| P0-005 | `unwrap()` in HTTP server request paths | **RESOLVED** — zero bare `.unwrap()` in production code; all 391 were in `#[cfg(test)]` modules |
| P0-006 | `unwrap()` in cryptographic code | **RESOLVED** — zero bare `.unwrap()` in production code; all 157 were in `#[cfg(test)]` modules |
| P0-007 | `unwrap()` in foundation layer | **RESOLVED** — zero bare `.unwrap()` in production code; all 139 were in `#[cfg(test)]` modules |
| P1-001 | Rate limiter before authentication | **RESOLVED** — auth runs first |
| P2-001 | `MsezError::NotImplemented` variant unused | **INCORRECT** — actively used in 10+ locations for Phase 2 stub endpoints |

---

## IV. UNWRAP ELIMINATION PROTOCOL

When encountering any `unwrap()` call, categorize and fix:

| Category | Example | Fix |
|----------|---------|-----|
| **Safe** — after a guard that guarantees `Some`/`Ok` | `let x = map.get(k).unwrap();` after `if map.contains_key(k)` | Annotate `// SAFETY: checked on line N` |
| **Lazy** — should propagate the error | `serde_json::from_str(s).unwrap()` | Replace with `?` or `.map_err(AppError::from)?` |
| **Static** — initialization of compile-time-known values | `Regex::new(r"...").unwrap()` | Replace with `expect("static regex — cannot fail")` |
| **Bug** — will panic on production data | `request.body.unwrap()` on user input | Fix with proper `Option`/`Result` handling and typed error |

**Status (2026-02-15)**: Production code in msez-api, msez-crypto, and msez-core
contains zero bare `.unwrap()` calls. All unwraps are in `#[cfg(test)]` modules.
Remaining crates (msez-pack, msez-state, msez-corridor, etc.) should be audited
to confirm the same pattern holds.

---

## V. PYTHON REMOVAL — COMPLETE

**Status (2026-02-15)**: All Python code has been removed from the repository.
The codebase is now pure Rust.

### What Was Removed

| Component | Lines | Disposition |
|-----------|-------|-------------|
| `tools/msez.py` | 15,476 | Removed — core commands ported to `msez-cli` |
| `tools/phoenix/` | 16,838 | Removed — reference implementation; production Rust crates cover all needed functionality |
| `tools/msez/composition.py` | 652 | **Ported** to `msez-pack/src/composition.rs` |
| `tools/*.py` (domain modules) | ~10,000 | Removed — all ported to corresponding `msez-*` crates |
| `tools/integrations/` | 289 | Removed — stubs, not production code |
| `tools/akoma/` | 171 | Removed — utilities, not production code |
| `tools/dev/` | 1,345 | Removed — development tools |
| `tests/*.py` (Python tests) | 32,796 | Removed — tested Python implementations, not Rust |
| `tests/generate_vectors.py` | 90 | Removed — digests hardcoded in Rust cross-language tests |

### Retained

- `tests/fixtures/` — JSON fixture files used by Rust integration tests
- `tests/README.md` — test documentation

### Rules

1. No Python code may be added to this repository.
2. All CLI commands must be implemented in `msez-cli` (Rust).
3. Cross-language test vectors are hardcoded in Rust test files.

---

## VI. NAMING CONVENTIONS (ENFORCED)

| Term | Usage | Never |
|------|-------|-------|
| **Momentum** | The fund and studio | "Momentum Protocol" |
| **Mass** | The product (five programmable primitives) | |
| **Mass Protocol** | Only in deeply technical contexts (L1, ZKP circuits) | In sales materials or casual usage |
| **SEZ Stack** | This open-source codebase | "Momentum Protocol", "MSEZ Protocol" |
| **momentum.inc** | Momentum's domain | momentum.xyz, momentum.io |
| **mass.inc** | Mass's domain | |

---

## VII. PRIORITY ORDERING

When conflicts arise, resolve in this order:

1. **Security** — key zeroization, constant-time comparison, auth (production traffic at risk)
2. **Correctness** — compliance tensor evaluation, corridor state, receipt chain integrity (wrong compliance = regulatory exposure)
3. **Mass/SEZ Boundary** — no primitive duplication, clean orchestration, `msez-mass-client` as sole gateway
4. **Unwrap elimination** — HTTP server first, crypto second, foundation third
5. **Architecture** — evolve proxy routes to orchestration, add persistence

---

## VIII. CRATE DEPENDENCY INVARIANTS

These invariants must hold at all times. Violating any is a blocking code review failure.

1. **`msez-core` has zero internal dependencies.** It depends only on `serde`, `serde_json`, `thiserror`, `chrono`, `uuid`, `sha2`.
2. **`msez-mass-client` has zero (or at most one) internal dependencies.** If it depends on `msez-core`, it is ONLY for identifier newtypes. It must never import SEZ Stack domain logic.
3. **No cycles in the dependency graph.**
4. **`msez-api` is the only crate that composes all others.** No other crate should depend on `msez-api`.
5. **All SHA-256 computation flows through `CanonicalBytes::new()`.** No crate may compute SHA-256 digests through any other path.
6. **`ComplianceDomain` is defined once in `msez-core`.** No other crate may define its own domain enum.

---

## IX. CODE REVIEW CHECKLIST

Before approving any change:

- [ ] No new `unwrap()` in `msez-api`, `msez-crypto`, or `msez-core` (except in tests)
- [ ] No `unimplemented!()` or `todo!()` in non-test code
- [ ] No new `anyhow` usage outside `msez-cli`
- [ ] No new `std::sync::RwLock` (use `parking_lot`)
- [ ] No SHA-256 computation bypassing `CanonicalBytes`
- [ ] No Mass primitive CRUD duplicated in SEZ Stack
- [ ] No Python code added to the repository
- [ ] Error types carry diagnostic context (not just `String`)
- [ ] Public functions have doc comments that describe behavior (not restate the name)
- [ ] Naming conventions followed (Momentum, Mass, SEZ Stack, momentum.inc, mass.inc)

---

## X. SUCCESS CRITERIA

The codebase is production-ready when:

1. `cargo check --workspace` passes with zero warnings
2. `cargo clippy --workspace -- -D warnings` passes clean
3. `cargo test --workspace` passes all tests
4. Zero `unwrap()` in `msez-api` request-handling paths
5. Zero `unwrap()` in `msez-crypto` non-test code
6. Zero `unimplemented!()` or `todo!()` in non-test code
7. `msez-mass-client` contract tests pass against live Mass API Swagger specs
8. Canonicalization and digest test vectors verified (Python removed; vectors hardcoded)
9. ~~The composition engine exists in Rust~~ **DONE** — `msez-pack::composition`
10. Each `mass_proxy` route is an orchestration endpoint (compliance + Mass API + VC)
11. Postgres persistence for corridor state, tensor snapshots, VC audit log, agentic policy state
12. The crate dependency graph has no cycles and no unnecessary edges

---

**End of CLAUDE.md v5.0**

Momentum · `momentum.inc`  
Mass · `mass.inc`  
Confidential · February 2026
