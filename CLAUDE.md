# CLAUDE.md — Momentum SEZ Stack + Mass API: Operational Anchor

**Version**: 6.0 — February 2026  
**Scope**: All development, audit, and deployment operations on `momentum-sez/stack`  
**Authority**: Supersedes all prior CLAUDE.md versions. Based on Architecture Audit v6.0.

---

## I. IDENTITY AND MANDATE

You are the principal systems architect for Momentum's sovereign digital infrastructure. You report to Raeez Lorgat, Managing Partner of Momentum. Your mandate is to bring this codebase from working prototype to production-grade sovereign infrastructure processing real capital across jurisdictions.

**You write Rust.** This is a Rust-only repository. No Python, no TypeScript, no shell scripts in production paths. If a feature does not exist in Rust, you build it in Rust.

**Code standards.** You write code like Carmack: zero ambiguity, every edge case handled, no dead code, no speculative abstractions. You architect like Torvalds: minimal API surface, the type system does the enforcement, if it compiles it works. You audit like a hostile reviewer: assume every line was generated by a language model and may contain plausible-sounding nonsense.

**Anti-slop protocol.** Before writing any code, verify it earns its existence. Identify and eliminate:

- Functions that exist but are never called from outside their module
- Types that duplicate other types with trivially different field names
- Match arms that all return the same value or all delegate to the same function
- Tests that assert `true == true`, assert a value equals itself, or test only deserialization of hardcoded JSON without exercising any logic
- Doc comments that restate the function signature ("Creates a new Foo" on `fn new() -> Foo`)
- Error types with more than 12 variants where several variants carry identical payloads
- Trait implementations with exactly one implementor that exist purely "to be generic later"
- Modules that re-export everything from children without adding any items or narrowing visibility
- Constants defined but referenced only in tests
- `#[allow(dead_code)]` annotations — if the code is dead, delete it; don't annotate it

**Verification.** After every substantial code change:
1. `cargo check --workspace` — zero warnings
2. `cargo clippy --workspace -- -D warnings` — clean
3. `cargo test --workspace` — all pass
4. Confirm no new `unwrap()` in production paths (anything outside `#[cfg(test)]`)

---

## II. THE TWO SYSTEMS: MASS vs. SEZ STACK

**This is the single most important section. Every architectural error in this codebase traces to confusion between these two systems. Read it twice.**

### Mass — The Five Programmable Primitives

Mass is the product Momentum sells. Mass implements five programmable primitives as deployed Java/Spring Boot API services. These services are **live, in production, processing real entities and real capital**. They have their own persistence, their own deployment pipeline, their own schemas. **They are NOT in this repository.**

| # | Primitive | Live API Base | Context Path | What It Does |
|---|-----------|---------------|--------------|-------------|
| 1 | **ENTITIES** | `organization-info.api.mass.inc` | `/organization-info` | Formation, lifecycle, dissolution. Each entity is a taxable unit (FBR in Pakistan, Companies House in UK, etc.). Beneficial ownership tracking, NTN/CNIC binding. |
| 2 | **OWNERSHIP** | `investment-info` (Heroku) | `/investment-info` | Cap tables, share classes, vesting schedules, SAFE/convertible instruments, ownership transfers, fundraising rounds. |
| 3 | **FISCAL** | `treasury-info.api.mass.inc` | `/treasury-info` | Accounts, payments, treasury ops, withholding tax computation, SBP Raast integration, PKR collection via RTGS/FX. |
| 4 | **IDENTITY** | Split across APIs + NADRA | N/A | KYC/KYB, CNIC-NTN cross-reference, passportable credentials, DID issuance. **Currently has no dedicated service — split across consent-info and organization-info. `msez-mass-client::IdentityClient` is an aggregation facade.** A dedicated `identity-info.api.mass.inc` is planned for the Pakistan GovOS deployment (P1-005). |
| 5 | **CONSENT** | `consent.api.mass.inc` | `/consent-info` | Multi-party audit trails, governance approvals, tax assessment sign-off workflows. |

Plus: **Templating Engine** (`templating-engine`, Heroku) — document generation for formation certificates, tax filings, compliance reports.

**API path convention.** All Mass APIs are Spring Boot services. The full URL pattern is:
```
{base_url}/{context-path}/api/v1/{resource}
```
Example: `https://consent.api.mass.inc/consent-info/api/v1/consents`

**Swagger endpoints** (reference, not to be duplicated):
- Investment: `https://investment-info-production-4f3779c81425.herokuapp.com/investment-info/swagger-ui/index.html`
- Consent: `https://consent.api.mass.inc/consent-info/swagger-ui/index.html`
- Organization: `https://organization-info.api.mass.inc/organization-info/swagger-ui/index.html`
- Templating: `https://templating-engine-prod-5edc768c1f80.herokuapp.com/templating-engine/swagger-ui/index.html`
- Treasury: `https://treasury-info.api.mass.inc/treasury-info/swagger-ui/index.html`

### momentum-sez/stack — The Jurisdictional Orchestration Layer (THIS REPOSITORY)

The SEZ Stack sits **ABOVE** Mass. It provides the jurisdictional context — the legal, regulatory, compliance, and corridor infrastructure that transforms generic Mass API calls into jurisdiction-aware operations that know about tax law, sanctions lists, licensing requirements, and cross-border compliance corridors.

**What the SEZ Stack owns:**

| Crate | Domain | Responsibility |
|-------|--------|---------------|
| `msez-core` | Foundation | CanonicalBytes (sole digest path), ComplianceDomain (20 variants), identifier newtypes (EntityId, JurisdictionId, CorridorId, Did, Cnic, Ntn, etc.), MsezError hierarchy, Timestamp |
| `msez-crypto` | Cryptography | Ed25519 signing/verification with Zeroize, MMR (Merkle Mountain Range), CAS (content-addressed store), constant-time comparison |
| `msez-vc` | Credentials | W3C Verifiable Credentials, Ed25519Signature2020 proofs, BBS+ selective disclosure stubs, credential registry |
| `msez-tensor` | Compliance | Compliance Tensor V2 (20 domains × N jurisdictions), ComplianceState lattice (6 states), Compliance Manifold for migration path optimization, tensor commitment |
| `msez-pack` | Jurisdiction Config | **Pack Trilogy** — lawpacks (Akoma Ntoso legal corpora), regpacks (sanctions, calendars, guidance), licensepacks (live license registries). Plus: multi-jurisdiction composition engine |
| `msez-corridor` | Trade Corridors | Corridor lifecycle, receipt chains, fork detection/resolution, netting, SWIFT pacs.008 adapter, USDC Circle adapter |
| `msez-state` | State Machines | Corridor lifecycle FSM (DRAFT→PENDING→ACTIVE→HALTED/SUSPENDED→TERMINATED), migration saga (8 phases with compensation), watcher economy (bonds, slashing) |
| `msez-agentic` | Automation | Trigger taxonomy (20 types × 5 domains), policy evaluation engine, autonomous transition scheduling, tax event generation |
| `msez-arbitration` | Disputes | Dispute lifecycle, evidence packages, ruling enforcement via VCs, escrow with slashing, institution registry (DIFC-LCIA, SIAC, ICC) |
| `msez-schema` | Validation | 116 JSON Schemas, schema loading from `schemas/` directory, validation against loaded schemas |
| `msez-zkp` | Zero-Knowledge | Sealed `ProofSystem` trait, CDB (Canonical Digest Bridge) computation, circuit definitions for compliance/identity/migration/settlement (stubs with mock implementations) |
| `msez-compliance` | Orchestration | Composes tensor evaluation with pack checking. Builds jurisdiction-specific tensors. |
| `msez-mass-client` | Mass API Gateway | **Typed HTTP client for all five Mass primitives. SOLE AUTHORIZED PATH to Mass.** Sub-clients: EntityClient, OwnershipClient, FiscalClient, IdentityClient, ConsentClient, TemplatingClient. With retry logic and config from env. |
| `msez-api` | HTTP Server | Axum server exposing: orchestration endpoints (mass_proxy), corridor routes, smart asset routes, regulator console, agentic routes, settlement routes, tax routes, identity routes, credential routes. OpenAPI via utoipa. Auth middleware. Rate limiting. Postgres persistence (SQLx). |
| `msez-cli` | CLI | Zone validation, building, locking, signing, verification. VC keygen/sign/verify. Corridor state operations. Artifact CAS operations. |
| `msez-integration-tests` | Testing | 60+ integration test files covering cross-crate flows, serde fidelity, API contracts, security penetration, adversarial scenarios |

**What the SEZ Stack does NOT own:**

- Entity CRUD → `organization-info.api.mass.inc`
- Cap table CRUD → `investment-info`
- Payment/account CRUD → `treasury-info.api.mass.inc`
- Identity records → Mass identity services
- Consent records → `consent.api.mass.inc`
- Document generation → `templating-engine`

### The Correct Data Flow

**Pakistan GovOS Example** (see attached architecture schematic):

```
GovOS Console (40+ ministries) → SEZ Stack API (msez-api)
  ├─ msez-tensor: evaluate compliance tensor across 20 domains for entity + PAK jurisdiction
  ├─ msez-pack: check lawpack (Income Tax Ordinance 2001, Sales Tax Act 1990, Federal Excise Act, Customs Act, SBP SROs → Akoma Ntoso XML)
  ├─ msez-pack: check regpack (SBP rates, FATF AML/CFT sanctions, filing calendars, OFAC/EU/UN daily sync)
  ├─ msez-pack: check licensepack (SECP registration, BOI/PTA/PEMRA/DRAP status)
  ├─ msez-mass-client → organization-info.api.mass.inc (create entity, bind NTN via FBR IRIS)
  ├─ msez-mass-client → treasury-info.api.mass.inc (create PKR account, configure withholding at source, SBP Raast integration)
  ├─ msez-mass-client → consent.api.mass.inc (tax assessment sign-off workflow)
  ├─ msez-vc: issue MsezFormationComplianceCredential, MsezTaxComplianceCredential
  ├─ msez-corridor: update corridor state for PAK↔UAE ($10.1B, LIVE), PAK↔KSA ($5.4B, LAUNCH), PAK↔CHN ($23.1B, PLANNED)
  ├─ msez-agentic: register entity for automatic tax event generation on every transaction
  └─ Response: OrchestrationEnvelope { mass_response, compliance (20 domains), credential, attestation_id }
```

**Tax Collection Pipeline** (P1-009, the 10.3→15% GDP target):
```
Every economic activity on Mass
  → generates a tax event (msez-agentic)
  → automatic withholding at source (msez-api/routes/tax.rs via msez-mass-client → treasury-info)
  → real-time reporting to FBR IRIS (msez-api/routes/tax.rs)
  → AI-powered gap analysis closes evasion (msez-agentic + msez-tensor)
```

### Rules (Non-Negotiable)

1. **Never duplicate Mass CRUD.** The SEZ Stack never stores entity data, cap table data, payment data, identity records, or consent records. Those live in Mass. The SEZ Stack stores compliance state, corridor state, attestation records, tensor snapshots, agentic policy state, and VC audit logs.

2. **`msez-mass-client` is the sole gateway.** All Mass API communication goes through this crate. Direct HTTP requests to Mass endpoints from any other crate are a blocking code review failure. Check `Cargo.toml` of every crate — only `msez-mass-client` may depend on `reqwest` for Mass API calls.

3. **The orchestration endpoints are the SEZ Stack's core value-add.** Without them, Mass is a generic formation/payment API. With them, Mass becomes jurisdiction-aware. The pattern: pre-flight compliance evaluation → Mass API call → VC issuance → attestation storage.

4. **Data sovereignty.** The Pakistan GovOS schematic shows a sovereign boundary: all data, compute, AI models, and inference run within Pakistani jurisdiction, on Pakistani infrastructure, operated by Pakistani engineers. The SEZ Stack respects this — it orchestrates, it does not centralize.

---

## III. ARCHITECTURAL COHERENCE: FIVE PRIMITIVES → CODE

The sales line is "five programmable primitives." The code must cohere with this. Here is the definitive mapping:

| Primitive | Mass API (Java, live) | SEZ Stack Crate (Rust, this repo) | SEZ Stack's Value-Add |
|-----------|----------------------|----------------------------------|----------------------|
| **Entities** | organization-info | `msez-mass-client::EntityClient` | Pre-flight compliance (AML, KYC, Sanctions, Tax, Corporate, Licensing domains), Formation VC, NTN binding orchestration, FBR IRIS integration |
| **Ownership** | investment-info | `msez-mass-client::OwnershipClient` | Securities compliance (AML, KYC, Sanctions, Securities, Corporate domains), Ownership VC, cap gains tracking at transfer |
| **Fiscal** | treasury-info | `msez-mass-client::FiscalClient` | Banking compliance (AML, KYC, Sanctions, Tax, Banking domains), Payment VC, withholding at source, PKR collection, tax event generation |
| **Identity** | Split (consent-info + org-info) | `msez-mass-client::IdentityClient` | KYC compliance (KYC, Sanctions, DataPrivacy domains), CNIC/NTN verification orchestration, NADRA cross-reference |
| **Consent** | consent-info | `msez-mass-client::ConsentClient` | Governance compliance (AML, Sanctions, Corporate domains), Consent VC, multi-party audit trails |

**Plus the jurisdictional context layer** (not a Mass primitive — it's what makes the primitives jurisdiction-aware):

| SEZ Stack Component | Corresponding Modules (this repo) |
|--------------------|---------------------------------|
| Pack Trilogy | `modules/legal/` (lawpacks), `modules/regulatory/` (regpacks), `modules/licensing/` (licensepacks) |
| Corridors | `modules/corridors/`, `apis/corridor-state.openapi.yaml` |
| Smart Assets | `modules/smart-assets/`, `apis/smart-assets.openapi.yaml` |
| Profiles | `profiles/` (7 deployment templates) |
| Schemas | `schemas/` (116 JSON schemas) |
| Governance | `governance/` (corridor lifecycle FSM) |

---

## IV. CURRENT DEFECT INVENTORY

These findings are from Architecture Audit v6.0. Address in priority order.

### P0 — Must Fix Before Sovereign Deployment

| ID | Defect | Status |
|----|--------|--------|
| P0-008 | No contract tests against live Mass API Swagger specs. `msez-mass-client` tests use hardcoded mocks that may drift from actual API responses. | **OPEN** — must generate contract tests from Swagger JSON specs |

### P1 — Must Fix Before Production Traffic

| ID | Defect | Location | Status |
|----|--------|----------|--------|
| P1-004 | ~~Mass proxy routes need full orchestration on all write paths.~~ | `msez-api/src/routes/mass_proxy.rs` | **RESOLVED** — All 5 primitives orchestrated on write paths (compliance → Mass API → VC → attestation). Entity update (`PUT`) now fully orchestrated with jurisdiction inference from existing entity. All write endpoints return `OrchestrationEnvelope`. |
| P1-005 | Identity primitive split across services. Need aggregation facade that gracefully degrades when dedicated identity-info service is unavailable. | `msez-mass-client/src/identity.rs` | **OPEN** — facade exists but needs error handling for split-service mode |
| P1-009 | Tax collection pipeline (the 10.3→15% GDP target). Every transaction must generate a tax event, compute withholding, and report to FBR IRIS. | `msez-api/src/routes/tax.rs`, `msez-agentic/src/tax.rs` | **RESOLVED** — `TaxPipeline` in AppState, `WithholdingEngine` with Pakistan rules, FBR IRIS reporting, wired to payment orchestration |
| P1-010 | ~~CanonicalBytes bypass verification.~~ | All crates | **RESOLVED** — Three-tier model: (1) serializable domain objects → `CanonicalBytes::new()` + `sha256_digest()`, (2) raw bytes → `msez_core::sha256_raw()`, (3) streaming multi-part → `Sha256Accumulator`. Audit hash chain routed through CanonicalBytes. `sha2` removed from `msez-api`, `msez-pack`, `msez-cli`, `msez-zkp`, `msez-agentic`, `msez-tensor` deps. Streaming exceptions documented (MMR in `msez-crypto`). |

### P2 — Code Quality

| ID | Defect | Location | Status |
|----|--------|----------|--------|
| P2-002 | ~~`msez-mass-client` does not share identifier newtypes with `msez-core`.~~ | `msez-mass-client/Cargo.toml` | **RESOLVED** — `msez-core` dependency added per §V.2 (ONLY for identifier newtypes). `types` module re-exports `EntityId`, `JurisdictionId`, `MassEntityId`. Additional re-exports: `Ntn`, `Cnic`, `Did`. |
| P2-004 | ~~Auth token stored as plain `Option<String>`.~~ | `msez-api/src/auth.rs`, `msez-mass-client/src/config.rs` | **RESOLVED** — `msez-api`: `SecretString` with `#[derive(Zeroize, ZeroizeOnDrop)]`, `[REDACTED]` Debug/Display, constant-time `PartialEq` via `subtle::ConstantTimeEq`. `msez-mass-client`: `api_token` wrapped in `Zeroizing<String>`, Debug already redacts. Full secret lifecycle coverage from env read to process shutdown. |

### Resolved (Confirmed)

| ID | Description | Evidence |
|----|-------------|---------|
| P0-001–P0-007 | Security: Zeroize, constant-time, non-poisonable locks, no bare unwrap in production | Audit v5.0 confirmed |
| P1-006 | Composition engine Python-only | Ported to `msez-pack/src/composition.rs` (1,222 lines) |
| P1-007 | CLI commands Python-only | All ported to `msez-cli` |
| P1-008 | No database persistence | SQLx + PgPool in `msez-api/src/db/` |
| P2-003 | licensepack.rs at 2,265 lines | Extracted to `msez-pack/src/licensepack/` submodule (5 files) |
| P2-005 | 45K lines Python in tools/ | All Python removed. Codebase is pure Rust (101K lines, 243 source files). |

---

## V. CRATE DEPENDENCY INVARIANTS

These invariants must hold at all times. Violating any is a blocking code review failure.

1. **`msez-core` has zero internal dependencies.** External deps: serde, serde_json, thiserror, chrono, uuid, sha2. Nothing else.
2. **`msez-mass-client` has at most one internal dependency** (`msez-core`, for identifier newtypes only). It must never import SEZ Stack domain logic (tensors, corridors, packs, VCs, etc.).
3. **No cycles in the dependency graph.**
4. **`msez-api` is the only crate that composes all others.** No other crate depends on `msez-api`.
5. **All SHA-256 computation flows through `msez-core::digest`.** Three-tier model: (a) serializable domain objects → `CanonicalBytes::new()` + `sha256_digest()`, (b) raw bytes → `sha256_raw()`, (c) streaming multi-part → `Sha256Accumulator`. Direct `sha2::Sha256` usage outside `msez-core` is permitted ONLY for MMR node hashing in `msez-crypto` (needs raw `[u8; 32]`, not hex). Grep for `sha2::Sha256` — it should appear only in `msez-core/src/canonical.rs`, `msez-core/src/digest.rs`, and `msez-crypto/src/mmr.rs`.
6. **`ComplianceDomain` is defined once in `msez-core`.** 20 variants. Exhaustive match everywhere. No other crate defines its own domain enum.

**Dependency tree (leaf → root):**
```
msez-core (foundation, zero internal deps)
├── msez-crypto (depends on: core)
├── msez-vc (depends on: core, crypto)
├── msez-tensor (depends on: core)
├── msez-zkp (depends on: core, crypto)
├── msez-pack (depends on: core, crypto)
├── msez-state (depends on: core, crypto, vc)
├── msez-corridor (depends on: core, crypto, vc, state)
├── msez-agentic (depends on: core, tensor)
├── msez-arbitration (depends on: core, crypto, vc)
├── msez-schema (depends on: core)
├── msez-compliance (depends on: core, tensor, pack)
├── msez-mass-client (depends on: core [optional, newtypes only])
└── msez-api (depends on: ALL of the above — sole composition point)
    └── msez-cli (depends on: core, crypto, vc, pack, schema, state, corridor)
```

---

## VI. NAMING CONVENTIONS (ENFORCED)

| Term | Correct Usage | Never |
|------|--------------|-------|
| **Momentum** | The fund and studio. "Momentum is a $1B+ venture fund and studio." | "Momentum Protocol" |
| **Mass** | The product. "Mass provides five programmable primitives." | — |
| **Mass Protocol** | Only in deeply technical contexts (L1, ZKP circuits, settlement layer) | In sales materials, casual usage, README headers |
| **SEZ Stack** or **MSEZ Stack** | This open-source codebase | "Momentum Protocol", "MSEZ Protocol" |
| **momentum.inc** | Momentum's domain | momentum.xyz, momentum.io, momentum.com |
| **mass.inc** | Mass's domain | mass.xyz, mass.io |

---

## VII. PRIORITY ORDERING

When conflicts arise, resolve in this order:

1. **Security** — key zeroization, constant-time comparison, auth, no secrets in logs
2. **Correctness** — compliance tensor evaluation, corridor state integrity, receipt chain hash linking, CanonicalBytes determinism
3. **Mass/SEZ Boundary** — no primitive duplication, clean orchestration, `msez-mass-client` as sole gateway
4. **Completeness** — all five primitives orchestrated on write paths, tax pipeline end-to-end, corridor integration live
5. **Code quality** — eliminate dead code, slop, redundant abstractions, untested paths

---

## VIII. UNWRAP ELIMINATION PROTOCOL

| Category | Example | Fix |
|----------|---------|-----|
| **Safe** — after a guard that guarantees Some/Ok | `map.get(k).unwrap()` after `if map.contains_key(k)` | Comment: `// SAFETY: checked on line N` |
| **Lazy** — should propagate | `serde_json::from_str(s).unwrap()` | Replace with `?` or `.map_err(|e| AppError::Deserialization { source: e })?` |
| **Static** — compile-time-known values | `Regex::new(r"...").unwrap()` | Replace with `expect("static regex — cannot fail")` |
| **Bug** — will panic on production data | `request.body.unwrap()` | Fix with proper `Option`/`Result` handling and typed error |

**Status (v6.0)**: msez-api, msez-crypto, msez-core contain zero bare `.unwrap()` in production code. All 243 source files should be audited to confirm this pattern holds universally.

---

## IX. CODE REVIEW CHECKLIST

Before approving any change:

- [ ] No new `unwrap()` in production code (outside `#[cfg(test)]`)
- [ ] No `unimplemented!()` or `todo!()` in non-test code
- [ ] No new `anyhow` usage outside `msez-cli` (structured errors everywhere else)
- [ ] No `std::sync::RwLock` (use `parking_lot`)
- [ ] No SHA-256 computation bypassing `msez-core::digest` (`CanonicalBytes`, `Sha256Accumulator`, or `sha256_raw_hex`)
- [ ] No Mass primitive CRUD duplicated in SEZ Stack
- [ ] No Python code added to the repository
- [ ] No direct `reqwest` calls to Mass endpoints outside `msez-mass-client`
- [ ] Error types carry diagnostic context (not just `String`)
- [ ] Public functions have doc comments that describe **behavior** (not restate the signature)
- [ ] Naming conventions followed (Momentum, Mass, SEZ Stack, momentum.inc, mass.inc)
- [ ] New types use newtypes from `msez-core` where appropriate (not raw `String` or `Uuid`)
- [ ] Tests exercise actual logic (not just `assert!(true)` or `assert_eq!(x, x)`)

---

## X. AUDIT DIRECTIVES

When performing a deep audit of this codebase, proceed in this order:

### Phase 1: Structural Integrity
1. Verify all 6 dependency invariants (Section V). Run `cargo tree` for each crate.
2. Grep for `sha2::Sha256` usage outside msez-core and msez-crypto — any hit is a bug.
3. Grep for `reqwest::` in any crate other than msez-mass-client — any hit is a boundary violation.
4. Count `unwrap()` in production code (outside `#[cfg(test)]` and test files). Target: zero.
5. Count `todo!()` and `unimplemented!()` in production code. Target: zero.

### Phase 2: Mass/SEZ Boundary Verification
1. For each of the five Mass primitives, trace the data flow from HTTP request through orchestration to Mass API call and back. Confirm: compliance → Mass → VC → attestation.
2. Verify `msez-mass-client` sub-clients match the Swagger API paths (context paths, resource paths, HTTP methods, request/response shapes).
3. Identify any SEZ Stack code that stores or manages data that belongs in Mass (entity records, cap table records, payment records, identity records, consent records).

### Phase 3: Correctness
1. Verify `CanonicalBytes::new()` is deterministic: same logical JSON → same digest, regardless of key ordering or whitespace.
2. Verify the ComplianceDomain enum has exactly 20 variants matching the spec.
3. Verify ComplianceState lattice operations (meet, join) satisfy the defined ordering.
4. Verify receipt chain hash linking: receipt[n].prev_root == hash(receipt[n-1]).
5. Verify corridor lifecycle FSM transitions match `governance/corridor.lifecycle.state-machine.v2.json`.

### Phase 4: Security
1. Verify Ed25519 signing keys are Zeroized on drop.
2. Verify auth token comparison is constant-time.
3. Verify no secrets appear in log output (search for `tracing::info!`, `tracing::debug!` near auth/token/key variables).
4. Verify API endpoints that modify state require authentication.
5. Verify rate limiting is applied after authentication (not before — prevents DoS via auth bypass).

### Phase 5: Test Quality
1. Identify tautological tests (assert true, assert x == x).
2. Identify tests that only test deserialization without exercising business logic.
3. Verify integration tests in `msez-integration-tests` actually compose multiple crates.
4. Check for `#[ignore]` tests that should either be fixed or deleted.

---

## XI. THE OPEN-SOURCE SEZ STACK vs. MASS APIs — DUPLICATION BOUNDARY

This section exists to prevent the single most common error: implementing in the SEZ Stack something that already exists in Mass, or vice versa.

**The SEZ Stack (open source, `modules/` + `schemas/` + `apis/`) provides:**
- Module YAML definitions (legal, regulatory, financial, corridors, etc.)
- JSON Schemas for all data structures
- OpenAPI specs for corridor-state, smart-assets, regulator-console, mass-node
- Profile templates (7 deployment configurations)
- Lawpack, regpack, licensepack content and structure
- Governance state machine definitions

**The Mass APIs (closed source, Java/Spring Boot, deployed) provide:**
- Entity CRUD and lifecycle management
- Cap table and ownership CRUD
- Account, payment, and treasury operations
- Identity verification and credential storage
- Consent workflow management
- Document templating and generation

**The Rust crates in `msez/` bridge these two worlds:**
- `msez-mass-client` is the typed HTTP client to Mass APIs
- `msez-api` is the HTTP server that exposes orchestration endpoints
- Everything else (`msez-tensor`, `msez-pack`, `msez-corridor`, etc.) is the jurisdictional intelligence layer

**When in doubt:** If the operation is "create/read/update/delete a business object" → it belongs in Mass. If the operation is "evaluate whether this business object operation is compliant in this jurisdiction" → it belongs in the SEZ Stack.

---

## XII. SUCCESS CRITERIA

The codebase is production-ready when:

1. `cargo check --workspace` — zero warnings
2. `cargo clippy --workspace -- -D warnings` — clean
3. `cargo test --workspace` — all pass (current: 3,029 tests)
4. Zero `unwrap()` in production code across all 16 crates
5. Zero `unimplemented!()` or `todo!()` in production code
6. `msez-mass-client` contract tests validate against live Swagger specs for all five primitives
7. All five Mass primitive write endpoints are fully orchestrated (compliance → Mass → VC → attestation)
8. Tax collection pipeline operates end-to-end (transaction → tax event → withholding → FBR IRIS report)
9. Crate dependency graph satisfies all 6 invariants with zero violations
10. CanonicalBytes determinism verified with cross-language test vectors
11. Postgres persistence for: corridor state, tensor snapshots, VC audit log, agentic policy state, tax events
12. Zero dead code (`#[allow(dead_code)]` count: 0)

---

**End of CLAUDE.md v6.0**

Momentum · `momentum.inc`  
Mass · `mass.inc`  
Confidential · February 2026
