# v0.4.34 — Receipt-chain checkpoint anchoring

This patch turns the Smart Asset receipt-chain checkpoint primitive into an **externally anchorable “asset log head”** that can be committed into corridor receipts as a typed attachment — enabling jurisdiction-sharded, fault-tolerant audit trails **without requiring a blockchain**.

## Operator UX

### Corridor receipts can anchor asset receipt-chain checkpoints

`mez corridor state receipt-init` now supports the following repeatable flags:

- `--attach-smart-asset-receipt-checkpoint <checkpoint.json>`
  - Appends a typed transition attachment:
    - `artifact_type: smart-asset-receipt-checkpoint`
    - `digest_sha256: sha256(JCS(checkpoint_without_proof))`

- `--attach-smart-asset-checkpoint <asset_checkpoint.json>`
  - Convenience: appends the existing asset state anchoring attachment:
    - `artifact_type: smart-asset-checkpoint`
    - `digest_sha256: <state_root_sha256>`

### Anchor verification can now traverse receipt-chain checkpoints + inclusion proofs

`mez asset anchor-verify` now supports:

- `--asset-receipt-checkpoint <checkpoint.json>`
  - Verifies that the corridor receipt contains a matching typed attachment committing to the checkpoint payload digest.

- Optional inclusion verification “portable audit packet” path:
  - `--asset-receipt <receipt.json>`
  - `--asset-inclusion-proof <proof.json>`

When provided, `anchor-verify` additionally verifies that the asset receipt is included in the supplied receipt-chain checkpoint.

## Specs and schemas

- Added: `schemas/smart-asset.receipt-checkpoint.attachment.schema.json`
- Updated: `schemas/smart-asset.inclusion-proof.schema.json` now accepts `checkpoint_ref.artifact_type` as either:
  - `checkpoint` (legacy)
  - `smart-asset-receipt-checkpoint` (typed)

## Implementation notes

- Added helper: `checkpoint_payload_digest_sha256()` for computing `sha256(JCS(checkpoint_without_proof))`.
- Strict artifact digest verification now treats `smart-asset-receipt-checkpoint` using the same semantic rule as `checkpoint`.

## Versioning

- Updated `STACK_SPEC_VERSION` to **0.4.34**.
- Updated starter profiles + `_starter/stack.lock` to **0.4.34**.
