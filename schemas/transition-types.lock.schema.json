{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://schemas.momentum-ez.org/mez/transition-types.lock.schema.json",
  "title": "MEZ Transition Type Registry Lock",
  "description": "Content-addressed snapshot of a Transition Type Registry. The snapshot_digest_sha256 is computed over the canonicalized snapshot section and can be referenced by corridor receipts to avoid repeating per-transition digests.",
  "type": "object",
  "required": [
    "transition_types_lock_version",
    "generated_at",
    "snapshot",
    "snapshot_digest_sha256"
  ],
  "properties": {
    "transition_types_lock_version": {
      "type": "integer",
      "minimum": 1
    },
    "generated_at": {
      "type": "string",
      "format": "date-time"
    },
    "source": {
      "type": "object",
      "description": "Optional provenance describing the authoring registry used to produce this snapshot.",
      "properties": {
        "registry_path": {"type": "string"},
        "registry_sha256": {
          "type": "string",
          "pattern": "^[a-f0-9]{64}$"
        }
      },
      "additionalProperties": true
    },
    "snapshot": {
      "type": "object",
      "required": ["tag", "registry_version", "transition_types"],
      "properties": {
        "tag": {
          "const": "mez.transition-types.registry.snapshot.v1"
        },
        "registry_version": {
          "type": "integer",
          "minimum": 1
        },
        "transition_types": {
          "type": "array",
          "minItems": 1,
          "items": {
            "type": "object",
            "required": ["kind"],
            "properties": {
              "kind": {
                "type": "string",
                "minLength": 1
              },
              "schema_digest_sha256": {
                "description": "Optional payload schema commitment. Legacy form is a raw sha256 digest; preferred form is an ArtifactRef with artifact_type='schema'.",
                "oneOf": [
                  {
                    "type": "string",
                    "pattern": "^[a-f0-9]{64}$"
                  },
                  {
                    "allOf": [
                      {
                        "$ref": "https://schemas.momentum-ez.org/mez/artifact-ref.schema.json"
                      },
                      {
                        "properties": {
                          "artifact_type": {
                            "const": "schema"
                          }
                        },
                        "required": [
                          "artifact_type",
                          "digest_sha256"
                        ]
                      }
                    ]
                  }
                ]
              },
              "ruleset_digest_sha256": {
                "description": "Optional ruleset commitment. Legacy form is a raw sha256 digest; preferred form is an ArtifactRef with artifact_type='ruleset'.",
                "oneOf": [
                  {
                    "type": "string",
                    "pattern": "^[a-f0-9]{64}$"
                  },
                  {
                    "allOf": [
                      {
                        "$ref": "https://schemas.momentum-ez.org/mez/artifact-ref.schema.json"
                      },
                      {
                        "properties": {
                          "artifact_type": {
                            "const": "ruleset"
                          }
                        },
                        "required": [
                          "artifact_type",
                          "digest_sha256"
                        ]
                      }
                    ]
                  }
                ]
              },
              "zk_circuit_digest_sha256": {
                "description": "Optional ZK circuit commitment. Legacy form is a raw sha256 digest; preferred form is an ArtifactRef with artifact_type='circuit'.",
                "oneOf": [
                  {
                    "type": "string",
                    "pattern": "^[a-f0-9]{64}$"
                  },
                  {
                    "allOf": [
                      {
                        "$ref": "https://schemas.momentum-ez.org/mez/artifact-ref.schema.json"
                      },
                      {
                        "properties": {
                          "artifact_type": {
                            "const": "circuit"
                          }
                        },
                        "required": [
                          "artifact_type",
                          "digest_sha256"
                        ]
                      }
                    ]
                  }
                ]
              }
            },
            "additionalProperties": true
          }
        }
      },
      "additionalProperties": true
    },
    "snapshot_digest_sha256": {
      "type": "string",
      "pattern": "^[a-f0-9]{64}$",
      "description": "SHA256(JCS(snapshot)) where snapshot excludes provenance and timestamps. Used as a stable content-addressed identifier for the registry snapshot."
    }
  },
  "additionalProperties": true
}
