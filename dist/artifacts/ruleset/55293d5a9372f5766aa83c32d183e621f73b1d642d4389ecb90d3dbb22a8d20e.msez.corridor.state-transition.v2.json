{
  "ruleset_id": "msez.corridor.state-transition.v2",
  "title": "MSEZ Corridor State Channel Transition Ruleset (Typed Envelopes + MMR)",
  "version": "2.0.0",
  "description": "Defines the canonical receipt payload, genesis_root, next_root computation, typed transition envelopes, and an inclusion-proof-friendly receipt accumulator (MMR).",
  "receipt_schema": "schemas/corridor.receipt.schema.json",
  "state_root": {
    "algorithm": "sha256",
    "canonicalization": "JCS (RFC8785 for objects without floats)",
    "encoding": "lowercase-hex"
  },
  "genesis_root_definition": "genesis_root = SHA256(JCS({tag:'msez.corridor.state.genesis.v1', corridor_id, definition_payload_sha256, agreement_set_sha256, lawpack_digest_set, ruleset_digest_set}))",
  "next_root_definition": "next_root = SHA256(JCS(receipt_without_proof_and_next_root))",
  "typed_transition_envelope": {
    "recommended": true,
    "envelope_type": "MSEZTransitionEnvelope",
    "required_fields": ["type", "kind", "payload_sha256"],
    "notes": "Transition envelopes allow corridor-specific semantics while keeping a generic receipt shape. payload_sha256 SHOULD be SHA256(JCS(payload)) when payload is embedded. Payload MAY be omitted for privacy; payload_sha256 still commits to the out-of-band payload."
  },
  "receipt_accumulator": {
    "type": "MMR",
    "algorithm": "sha256",
    "domain_separation": {
      "leaf": "leaf_hash = SHA256(0x00 || next_root_bytes)",
      "node": "node_hash = SHA256(0x01 || left_child || right_child)"
    },
    "root": "mmr_root = bag_peaks(peaks) where bag_peaks folds peaks from right-to-left using node_hash",
    "proofs": {
      "supported": true,
      "inclusion_proof": "A verifier can prove a specific receipt digest is included in an MMR committed by a signed checkpoint, without disclosing other receipts.",
      "checkpoint_schema": "schemas/corridor.checkpoint.schema.json",
      "proof_schema": "schemas/corridor.inclusion-proof.schema.json"
    },
    "notes": "This accumulator is complementary to the hash-chain state_root: the hash chain provides ordering and head/root continuity; the MMR provides receipt inclusion proofs."
  },
  "zk_scaffold": {
    "supported": true,
    "notes": "ZK proofs are optional and included as digests inside the receipt; verification and capability negotiation are corridor-specific."
  },
  "anchoring_scaffold": {
    "supported": true,
    "notes": "Roots may be periodically anchored to an external chain without changing the root model."
  }
}
