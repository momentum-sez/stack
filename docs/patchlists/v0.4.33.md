# v0.4.33 â€” Smart-asset fork resolution

This release makes Smart Asset receipt chains robust under concurrency (multiple writers producing receipts for the same `(sequence, prev_root)`), by introducing an **asset-local fork-resolution credential** and aligning the chain selection semantics with corridor state channels.

## Additions

### 1) Smart-asset fork-resolution artifacts

- New schemas:
  - `schemas/smart-asset.fork-resolution.schema.json`
  - `schemas/vc.smart-asset-fork-resolution.schema.json`

These define a small, portable object (recommended packaging is a signed VC) that selects a canonical `chosen_next_root` for a fork point.

### 2) Fork-aware receipt-chain verification (asset-local)

Smart-asset chain verification now:

- **Merges duplicates** (same `(sequence, prev_root, next_root)` but multiple proofs)
- **Detects forks** (same `(sequence, prev_root)` but multiple `next_root` candidates)
- **Selects a canonical branch** when fork resolutions are provided
- Treats non-canonical/unreachable receipts as **warnings** (not hard errors), matching corridor semantics

New/updated CLI flags:

- `mez asset state verify --fork-resolutions <file-or-dir>`
- `mez asset state checkpoint --fork-resolutions <file-or-dir>`
- `mez asset state inclusion-proof --fork-resolutions <file-or-dir>`

When operating on an asset module directory (`modules/smart-assets/<asset_id>/...`), the default fork-resolution location is now:

- `state/fork-resolutions/`

### 3) Operator UX: fork-resolution init

New command:

- `mez asset state fork-resolve` (alias: `fork-resolution-init`)

This generates an **unsigned fork-resolution VC** that can be signed/attested by an operator, authority, or quorum process.

### 4) Smart-asset JSON-LD context

- Added `contexts/mez/smart-asset/v1.jsonld`.

## Version bump

- Updated `STACK_SPEC_VERSION` to **0.4.33** and aligned starter profiles.
